(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4029,6648],{20063:(e,a,t)=>{"use strict";var r=t(47260);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},33810:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var r=t(95155),i=t(12115),l=t(33946),n=t(20063);function s(e){let{initialValue:a,onSave:t,onCancel:n,onImageFileUpload:s,onAadhaarUpload:o,onPanUpload:d,showIdentityUpload:u=!0}=e,[c,m]=(0,i.useState)(""),[h,p]=(0,i.useState)(""),[g,f]=(0,i.useState)((null==a?void 0:a.designation)||""),[x,v]=(0,i.useState)((null==a?void 0:a.tagline)||""),[b,w]=(0,i.useState)((null==a?void 0:a.imageUrl)||""),[y,N]=(0,i.useState)((null==a?void 0:a.aadhaarUrl)||""),[j,U]=(0,i.useState)((null==a?void 0:a.panUrl)||""),[_,S]=(0,i.useState)((null==a?void 0:a.aadhaarUrl)?"aadhaar":(null==a?void 0:a.panUrl)?"pan":"aadhaar"),[P,C]=(0,i.useState)(!1),{show:k}=(0,l.M)(),[A,I]=(0,i.useState)({}),M=(0,i.useRef)(!1);(0,i.useEffect)(()=>{if(M.current||!((null==a?void 0:a.name)||(null==a?void 0:a.designation)||(null==a?void 0:a.tagline)))return;let e=String((null==a?void 0:a.name)||"").trim();if(e){let a=e.split(/\s+/),t=a.shift()||"",r=a.join(" ");m(t),p(r)}else m(""),p("");f((null==a?void 0:a.designation)||""),v((null==a?void 0:a.tagline)||""),M.current=!0},[null==a?void 0:a.name,null==a?void 0:a.designation,null==a?void 0:a.tagline]),(0,i.useEffect)(()=>{w((null==a?void 0:a.imageUrl)||"")},[null==a?void 0:a.imageUrl]),(0,i.useEffect)(()=>{N((null==a?void 0:a.aadhaarUrl)||""),U((null==a?void 0:a.panUrl)||""),S((null==a?void 0:a.aadhaarUrl)?"aadhaar":(null==a?void 0:a.panUrl)?"pan":"aadhaar")},[null==a?void 0:a.aadhaarUrl,null==a?void 0:a.panUrl]);let E=async e=>{var a,t;if(!e)return;if(!(null==(t=e.type)||null==(a=t.startsWith)?void 0:a.call(t,"image/")))return void alert("Please select an image file.");if(e.size>4194304)return void alert("Image too large. Max 4MB.");try{if("function"==typeof s){let a=await s(e);if(a)return void w(a)}}catch(e){console.warn("Upload failed; falling back to preview only.",e)}let r=new FileReader;r.onload=()=>w(String(r.result)),r.readAsDataURL(e)},T=async()=>{let{errs:e}=(()=>{let e={},t=!!(b||(null==a?void 0:a.imageUrl));return c.trim()||(e.firstName="First name is required"),g.trim()||(e.designation="Designation is required"),t||(e.imageUrl="Profile photo is required"),y||j||(e.document="Upload either Aadhaar or PAN"),{errs:e}})();if(Object.keys(e).length>0){I(e);try{let a=Object.keys(e)[0],t=document.querySelector('[data-field="'.concat(a,'"]'));t&&"function"==typeof t.scrollIntoView&&t.scrollIntoView({behavior:"smooth",block:"center"})}catch(e){}try{k({title:"Fix form errors",description:"Upload Aadhaar or PAN and fill required fields.",variant:"warning"})}catch(e){}return}let r="".concat(c," ").concat(h).trim(),i={...a,name:r||(null==a?void 0:a.name)||"",designation:g.trim(),tagline:x.trim(),imageUrl:b||(null==a?void 0:a.imageUrl)||"",aadhaarUrl:y||(null==a?void 0:a.aadhaarUrl)||"",panUrl:j||(null==a?void 0:a.panUrl)||""};try{C(!0),await (null==t?void 0:t(i));try{k({title:"Saved",description:"Profile updated successfully.",variant:"success"})}catch(e){}}finally{C(!1)}};return(0,r.jsxs)("section",{className:"rounded-2xl border border-border bg-card/70 p-6 md:p-8 shadow-sm","aria-labelledby":"profile-editor-title",children:[(0,r.jsx)("h2",{id:"profile-editor-title",className:"text-xl md:text-2xl font-bold text-foreground",children:"Profile Settings"}),(0,r.jsxs)("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,r.jsxs)("label",{className:"block text-left",children:[(0,r.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"First Name *"}),(0,r.jsx)("input",{"data-field":"firstName",value:c,onChange:e=>m(e.target.value),className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border placeholder:text-muted-foreground focus:ring-2 focus:outline-none",placeholder:"Your first name",required:!0}),A.firstName&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-400",children:A.firstName})]}),(0,r.jsxs)("label",{className:"block text-left",children:[(0,r.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Last Name"}),(0,r.jsx)("input",{"data-field":"lastName",value:h,onChange:e=>p(e.target.value),className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border placeholder:text-muted-foreground focus:ring-2 focus:outline-none",placeholder:"Your last name (optional)"})]}),(0,r.jsxs)("label",{className:"block text-left",children:[(0,r.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Designation *"}),(0,r.jsx)("input",{"data-field":"designation",value:g,onChange:e=>f(e.target.value),className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border placeholder:text-muted-foreground focus:ring-2 focus:outline-none",placeholder:"Trustee, Devotee, Priest, ...",required:!0}),A.designation&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-400",children:A.designation})]}),(0,r.jsxs)("label",{className:"md:col-span-2 block text-left",children:[(0,r.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Tagline (optional)"}),(0,r.jsx)("input",{"data-field":"tagline",value:x,onChange:e=>v(e.target.value),className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border placeholder:text-muted-foreground focus:ring-2 focus:outline-none",placeholder:"Swamiye Saranam Ayyappa"})]}),(0,r.jsxs)("div",{className:"md:col-span-2 grid grid-cols-1 sm:grid-cols-[auto_1fr] items-center gap-4",children:[(0,r.jsx)("div",{className:"shrink-0",children:b||(null==a?void 0:a.imageUrl)?(0,r.jsx)("img",{src:b||(null==a?void 0:a.imageUrl)||void 0,alt:"Current profile",className:"h-24 w-24 rounded-full object-cover ring-2 ring-[#D4AF37]"}):(0,r.jsx)("div",{"aria-label":"No profile photo",className:"h-24 w-24 rounded-full ring-2 ring-[#D4AF37] bg-white/10 animate-pulse"})}),(0,r.jsxs)("label",{className:"block text-left",children:[(0,r.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Profile Photo *"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;return E((null==(a=e.target.files)?void 0:a[0])||null)},className:"w-full cursor-pointer rounded-xl bg-white/5 px-4 py-2.5 text-sm ring-1 ring-border file:mr-3 file:rounded-md file:border-0 file:bg-white/10 file:px-3 file:py-2 file:text-sm hover:file:bg-white/20 focus:ring-2 focus:outline-none","aria-label":"Upload profile photo"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"Max 4MB. JPG/PNG recommended."}),A.imageUrl&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-400",children:A.imageUrl})]})]}),u&&(0,r.jsxs)("div",{className:"md:col-span-2 mt-4",children:[(0,r.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Identity Document *"}),(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-6 text-sm",children:[(0,r.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,r.jsx)("input",{type:"radio",name:"docChoice",value:"aadhaar",checked:"aadhaar"===_,onChange:()=>S("aadhaar")}),"Aadhaar"]}),(0,r.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,r.jsx)("input",{type:"radio",name:"docChoice",value:"pan",checked:"pan"===_,onChange:()=>S("pan")}),"PAN"]})]}),(0,r.jsxs)("div",{className:"mt-3 flex items-center gap-4",children:["aadhaar"===_?y?y.endsWith(".pdf")?(0,r.jsx)("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"text-xs underline",children:"View file"}):(0,r.jsx)("img",{src:y,alt:"Aadhaar",className:"h-16 w-16 rounded object-cover ring-1 ring-border"}):null:j?j.endsWith(".pdf")?(0,r.jsx)("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"text-xs underline",children:"View file"}):(0,r.jsx)("img",{src:j,alt:"PAN",className:"h-16 w-16 rounded object-cover ring-1 ring-border"}):null,(0,r.jsx)("input",{type:"file",accept:"image/*,application/pdf",onChange:async e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];if(t)try{if("aadhaar"===_){if("function"==typeof o){let e=await o(t);N(e)}}else if("function"==typeof d){let e=await d(t);U(e)}}catch(e){alert(((null==e?void 0:e.message)||"Upload failed").toString())}},className:"w-full cursor-pointer rounded-xl bg-white/5 px-4 py-2.5 text-sm ring-1 ring-border file:mr-3 file:rounded-md file:border-0 file:bg-white/10 file:px-3 file:py-2 file:text-sm hover:file:bg-white/20 focus:ring-2 focus:outline-none","aria-label":"Upload identity document"})]}),A.document&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-400",children:A.document}),(0,r.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"Choose Aadhaar or PAN and upload an image or PDF (max 5MB). Only one is required."})]}),(0,r.jsxs)("div",{className:"md:col-span-2 flex items-center gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:T,disabled:P,className:"px-5 py-2.5 rounded-lg text-sm font-semibold bg-amber-600 text-white focus:outline-none focus:ring-2 focus:ring-amber-500 disabled:opacity-60","aria-label":"Save profile",children:P?"Saving…":"Save Changes"}),(0,r.jsx)("button",{type:"button",onClick:()=>{let e=String((null==a?void 0:a.name)||"").trim();if(e){let a=e.split(/\s+/),t=a.shift()||"",r=a.join(" ");m(t),p(r)}else m(""),p("");f((null==a?void 0:a.designation)||""),v((null==a?void 0:a.tagline)||""),w((null==a?void 0:a.imageUrl)||""),null==n||n()},className:"px-4 py-2 rounded-lg text-sm font-medium ring-1 ring-border text-foreground","aria-label":"Cancel editing",children:"Cancel"})]})]})]})}var o=t(96648),d=t(48210);function u(){let e=(0,n.useRouter)(),{show:a}=(0,l.M)(),[t,u]=(0,i.useState)({name:"",designation:"",tagline:"",imageUrl:"",bioParagraphs:[""],highlights:[""],aadhaarUrl:"",panUrl:""}),[c,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{let a=(0,o.getSupabaseBrowserClient)(),{data:t}=await a.auth.getUser(),r=null==t?void 0:t.user;if(!r)return e.replace("/sign-in/?next=/profile/edit/");let i=!1;try{i=(Array.isArray(null==r?void 0:r.identities)?r.identities:[]).some(e=>(null==e?void 0:e.provider)==="email")}catch(e){i=!1}try{var l,n;let e=String((null==(l=r.user_metadata)?void 0:l.full_name)||(null==(n=r.user_metadata)?void 0:n.name)||"").trim(),a=String(r.email||"").split("@")[0]||"",t=e||a||"";u(e=>({...e,name:e.name||t}))}catch(e){}let{data:s,error:d}=await a.from("Profile-Table").select("*").eq("user_id",r.id).maybeSingle();if(d||!s){let e=await a.from("Profile-Table").select("*").eq("id",r.id).maybeSingle();s=e.data,d=e.error}if(!d&&s){u(e=>({...e,name:s.name||s.full_name||e.name,designation:s.designation||e.designation,tagline:s.tagline||e.tagline,imageUrl:s.image_url||s.avatar_url||e.imageUrl,bioParagraphs:Array.isArray(s.bio_paragraphs)?s.bio_paragraphs:e.bioParagraphs,highlights:Array.isArray(s.highlights)?s.highlights:e.highlights,aadhaarUrl:s.aadhaar_url||s.aadhar_url||e.aadhaarUrl||"",panUrl:s.pan_url||e.panUrl||""}));try{let e=!!(s.aadhaar_url||s.aadhar_url||s.pan_url);m(!i&&!e)}catch(e){m(!0)}}s||m(!i)})()},[e]);let h=async t=>{let r=(0,o.getSupabaseBrowserClient)(),{data:i}=await r.auth.getUser(),l=null==i?void 0:i.user;if(!l)return void e.replace("/sign-in/?next=/profile/edit/");let n={name:t.name||"",full_name:t.name||"",designation:t.designation||"",tagline:t.tagline||"",avatar_url:t.imageUrl||"",image_url:t.imageUrl||"",aadhaar_url:t.aadhaarUrl||"",pan_url:t.panUrl||"",bio_paragraphs:Array.isArray(t.bioParagraphs)?t.bioParagraphs:[],highlights:Array.isArray(t.highlights)?t.highlights:[]},s=async(e,a)=>r.from("Profile-Table").upsert({[e]:l.id,...a},{onConflict:e}).select("*"),d=await s("user_id",n);if(d.error&&(d=await s("id",n)),d.error){let e={name:n.name,full_name:n.full_name,designation:n.designation,tagline:n.tagline,avatar_url:n.avatar_url,image_url:n.image_url,bio_paragraphs:n.bio_paragraphs,highlights:n.highlights};(d=await s("user_id",e)).error&&(d=await s("id",e))}if(d.error)return void a({title:"Save failed",description:d.error.message,variant:"error"});a({title:"Profile updated",description:"Your changes have been saved.",variant:"success"});try{let a=new URL(window.location.href).searchParams.get("next");e.push(a||"/")}catch(a){e.push("/")}};async function p(e){let a=(0,o.getSupabaseBrowserClient)(),{data:t}=await a.auth.getUser(),r=null==t?void 0:t.user;if(!r)throw Error("Not signed in");let i=e.name.split(".").pop()||"jpg",l="avatars/".concat(r.id,"-").concat(Date.now(),".").concat(i),{error:n}=await a.storage.from("avatars").upload(l,e,{upsert:!1,cacheControl:"3600"});if(n)throw n;let{data:s}=a.storage.from("avatars").getPublicUrl(l),d=s.publicUrl;try{await a.from("profile_photos").insert({user_id:r.id,url:d})}catch(e){}return u(e=>({...e,imageUrl:d})),d}async function g(e,a){var t,r;let i=(0,o.getSupabaseBrowserClient)(),{data:l}=await i.auth.getUser(),n=null==l?void 0:l.user;if(!n)throw Error("Not signed in");let s=(n.email||"user").toLowerCase().replace(/[^a-z0-9._-]/gi,"_"),d=a.name.split(".").pop()||((null==(t=a.type)?void 0:t.includes("png"))?"png":(null==(r=a.type)||r.includes("jpeg"),"jpg")),u="".concat(e,"/").concat(s,".").concat(d),c="PAN-Aadhar",{error:m}=await i.storage.from(c).upload(u,a,{upsert:!0,cacheControl:"3600"});if(m)throw m;let{data:h}=i.storage.from(c).getPublicUrl(u);return h.publicUrl}async function f(e){var a;if(!e)throw Error("No file provided");if(!((null==(a=e.type)?void 0:a.startsWith("image/"))||"application/pdf"===e.type))throw Error("Please upload an image or PDF");if(e.size>5242880)throw Error("Max file size 5MB");let t=await g("aadhaar",e);return u(e=>({...e,aadhaarUrl:t})),t}async function x(e){var a;if(!e)throw Error("No file provided");if(!((null==(a=e.type)?void 0:a.startsWith("image/"))||"application/pdf"===e.type))throw Error("Please upload an image or PDF");if(e.size>5242880)throw Error("Max file size 5MB");let t=await g("pan",e);return u(e=>({...e,panUrl:t})),t}return(0,r.jsx)(d.default,{children:(0,r.jsx)("main",{className:"min-h-screen bg-background text-foreground",children:(0,r.jsxs)("div",{className:"mx-auto max-w-4xl px-4 pt-28 pb-12",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("button",{type:"button",onClick:()=>e.back(),className:"rounded-md px-3 py-1.5 text-sm ring-1 ring-border text-foreground hover:bg-white/5",children:"← Back"})}),(0,r.jsx)(s,{initialValue:t,onSave:h,onCancel:()=>{e.back()},onImageFileUpload:p,onAadhaarUpload:f,onPanUpload:x,showIdentityUpload:c})]})})})}},33946:(e,a,t)=>{"use strict";t.d(a,{M:()=>s,S:()=>o});var r=t(95155),i=t(12115),l=t(65034);let n=(0,i.createContext)(null);function s(){let e=(0,i.useContext)(n);return e||{show:e=>{var a;let t="".concat(null!=(a=e.title)?a:"").concat(e.description?": ".concat(e.description):"").trim();try{t&&window.alert(t)}catch(e){}}}}function o(e){let{children:a}=e,[t,s]=(0,i.useState)([]),[o,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>d(!0),[]);let u=(0,i.useCallback)(e=>{var a,t,r;let i=Date.now()+Math.floor(1e3*Math.random()),l={id:i,title:null!=(a=e.title)?a:"",description:null!=(t=e.description)?t:"",variant:null!=(r=e.variant)?r:"info",durationMs:"number"==typeof e.durationMs?e.durationMs:3e3};s(e=>[...e,l]),l.durationMs&&l.durationMs>0&&setTimeout(()=>{s(e=>e.filter(e=>e.id!==i))},l.durationMs)},[]),c=(0,i.useMemo)(()=>({show:u}),[u]);return(0,r.jsxs)(n.Provider,{value:c,children:[a,o?(0,r.jsx)("div",{suppressHydrationWarning:!0,className:"pointer-events-none fixed bottom-4 right-4 z-50 flex w-[92vw] max-w-md flex-col-reverse gap-3 sm:w-auto",children:t.map(e=>(0,r.jsx)("div",{className:"pointer-events-auto",children:(0,r.jsx)(l.A,{variant:e.variant,title:e.title,description:e.description})},e.id))}):null]})}},48210:(e,a,t)=>{"use strict";t.d(a,{default:()=>i});var r=t(95155);function i(e){let{children:a}=e;return(0,r.jsx)(r.Fragment,{children:a})}t(12115)},64269:(e,a,t)=>{"use strict";t.d(a,{cn:()=>l});var r=t(2821),i=t(75889);function l(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,i.QP)((0,r.$)(a))}},65034:(e,a,t)=>{"use strict";t.d(a,{A:()=>h});var r=t(95155),i=t(12115),l=t(24342),n=t(951),s=t(61362),o=t(65229),d=t(52056),u=t(23327),c=t(64269);let m={success:(0,r.jsx)(s.A,{className:"h-6 w-6"}),error:(0,r.jsx)(o.A,{className:"h-6 w-6"}),warning:(0,r.jsx)(d.A,{className:"h-6 w-6"}),info:(0,r.jsx)(u.A,{className:"h-6 w-6"})};function h(e){let{variant:a="success",title:t="Default Alert Title",description:s="This is a default description for the alert. You can customize this text by passing props."}=e,[d,u]=(0,i.useState)(!0);return(0,r.jsx)(l.N,{children:d&&(0,r.jsxs)(n.P.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.25},className:(0,c.cn)("relative w-full max-w-md mx-auto p-4 rounded-2xl shadow-lg border","bg-white text-black border-black/10"),role:"status","aria-live":"polite",children:[(0,r.jsx)("button",{onClick:()=>u(!1),className:"absolute top-3 right-3 rounded-full p-1 hover:bg-black/10 transition","aria-label":"Dismiss alert",children:(0,r.jsx)(o.A,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 font-normal",children:m[a]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("h4",{className:"text-base font-semibold",children:t}),s&&(0,r.jsx)("p",{className:"text-sm text-black opacity-80 mt-1",children:s})]})]})]})})}},90569:(e,a,t)=>{Promise.resolve().then(t.bind(t,33810))},96648:(e,a,t)=>{"use strict";t.r(a),t.d(a,{getSupabaseBrowserClient:()=>l});var r=t(85553);let i=globalThis;function l(){let e="https://lszcuaduebvabtifhbgp.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzemN1YWR1ZWJ2YWJ0aWZoYmdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzOTk5NTIsImV4cCI6MjA3NDk3NTk1Mn0.voMu1-4SKxSjZ1LK6x7shGKFI37YW8PtLFJKpPYvCAM";if(!e||!a)throw Error("Supabase env vars missing. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");let t=function(e,a){try{let a=new URL(e).host.split(".")[0];return"ayya.supabase.".concat(a,".auth.v1")}catch(e){return"ayya.supabase.".concat((a||"").slice(0,8),".auth.v1")}}(e,a);if(i.__supabaseClients[t])return i.__supabaseClients[t];let l=(0,r.UU)(e,a,{auth:{persistSession:!0,autoRefreshToken:!0,flowType:"pkce",detectSessionInUrl:!0,storageKey:t},global:{headers:{"x-ayya-client":"web"}},realtime:{params:{eventsPerSecond:2}}});return i.__supabaseClients[t]=l,l}null!=i.__supabaseClients||(i.__supabaseClients={})}},e=>{e.O(0,[1029,5553,951,4909,2090,8441,1255,7358],()=>e(e.s=90569)),_N_E=e.O()}]);