(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6648,8362],{10323:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s=a(95155),n=a(12115),l=a(20063),i=a(33946),r=a(96648),o=a(52828),c=a(54348);function d(){let[e,t]=(0,n.useState)(""),[a,d]=(0,n.useState)("all"),[u,m]=(0,n.useState)(null),[h,p]=(0,n.useState)(!1),[x,f]=(0,n.useState)(null),b=(0,l.useRouter)(),{show:g}=(0,i.M)(),y=async()=>{f(null),p(!0);try{let t=(0,r.getSupabaseBrowserClient)(),s="1pm-3pm"===a,n="8pm-10pm"===a,{data:l,error:i}=await t.rpc("admin_list_annadanam_bookings",{start_date:e||null,end_date:e||null,sess:!(s||n)&&a&&"all"!==a?a:null,limit_rows:500,offset_rows:0});if(i)throw i;let o=Array.isArray(l)?l:[];if(s){let e=new Set(["1:00 PM - 1:30 PM","1:30 PM - 2:00 PM","2:00 PM - 2:30 PM","2:30 PM - 3:00 PM"]);o=o.filter(t=>e.has(String((null==t?void 0:t.session)||"")))}if(n){let e=new Set(["8:00 PM - 8:30 PM","8:30 PM - 9:00 PM","9:00 PM - 9:30 PM","9:30 PM - 10:00 PM"]);o=o.filter(t=>e.has(String((null==t?void 0:t.session)||"")))}let c=e=>{let t=(e||"").match(/^(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!t)return 0;let a=parseInt(t[1]||"0",10)%12;"PM"===(t[3]||"").toUpperCase()&&(a+=12);let s=60*a+parseInt(t[2]||"0",10);return Number.isFinite(s)?s:0},d=e=>{let t=Date.parse(String(e));return Number.isFinite(t)?t:0},u=[...o].sort((e,t)=>{let a=d(null==e?void 0:e.date),s=d(null==t?void 0:t.date);if(a!==s)return a-s;let n=c(String((null==e?void 0:e.session)||"")),l=c(String((null==t?void 0:t.session)||""));if(n!==l)return n-l;let i=String((null==e?void 0:e.created_at)||""),r=String((null==t?void 0:t.created_at)||"");return i.localeCompare(r)});m(u),0===o.length&&g({title:"No results",description:"No Annadanam bookings match the filters.",variant:"info"})}catch(e){f((null==e?void 0:e.message)||"Failed to load Annadanam bookings"),m(null)}finally{p(!1)}},j=async()=>{if(!u||0===u.length)return void alert("Nothing to download. Load Annadanam bookings first.");await (0,c.Z)("Annadanam Bookings",e||void 0,[{key:"date",label:"Date",w:90},{key:"session",label:"Session",w:120,align:"center"},{key:"name",label:"Name",w:180},{key:"email",label:"Email",w:220},{key:"phone",label:"Phone",w:120},{key:"attended_at",label:"Attended At",w:130}],u,"annadanam-bookings".concat(e?"-".concat(e):""))};return(0,s.jsx)(o.A,{children:(0,s.jsx)("main",{className:"min-h-screen p-6 md:p-10",children:(0,s.jsxs)("div",{className:"mx-auto max-w-3xl",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center",children:"Annadanam"}),(0,s.jsxs)("div",{className:"mt-2 flex justify-between",children:[(0,s.jsx)("button",{onClick:()=>b.push("/admin"),className:"rounded border px-3 py-1.5",children:"Back"}),(0,s.jsx)("button",{onClick:()=>b.push("/admin/annadanam/scan"),className:"rounded border px-3 py-1.5",children:"QR Scanner"})]}),(0,s.jsxs)("div",{className:"rounded-xl border p-6 space-y-4 bg-card/70 mt-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",htmlFor:"annaDate",children:"Date"}),(0,s.jsx)("input",{id:"annaDate",type:"date",className:"w-full rounded border px-3 py-2 bg-background",value:e,onChange:e=>t(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",htmlFor:"annaSession",children:"Timing"}),(0,s.jsxs)("select",{id:"annaSession",className:"w-full rounded border px-3 py-2 bg-background",value:a,onChange:e=>d(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Timings"}),(0,s.jsx)("option",{value:"1pm-3pm",children:"1:00 PM to 3:00 PM"}),(0,s.jsx)("option",{value:"8pm-10pm",children:"8:00 PM to 10:00 PM"}),(0,s.jsx)("option",{children:"1:00 PM - 1:30 PM"}),(0,s.jsx)("option",{children:"1:30 PM - 2:00 PM"}),(0,s.jsx)("option",{children:"2:00 PM - 2:30 PM"}),(0,s.jsx)("option",{children:"2:30 PM - 3:00 PM"}),(0,s.jsx)("option",{children:"8:00 PM - 8:30 PM"}),(0,s.jsx)("option",{children:"8:30 PM - 9:00 PM"}),(0,s.jsx)("option",{children:"9:00 PM - 9:30 PM"}),(0,s.jsx)("option",{children:"9:30 PM - 10:00 PM"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2 flex-wrap",children:[(0,s.jsx)("button",{onClick:y,disabled:h,className:"rounded bg-black text-white px-4 py-2",children:h?"Loading…":"Load Bookings"}),(0,s.jsx)("button",{onClick:()=>u&&((e,t)=>{let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(s)})(u,"annadanam-bookings".concat(e?"-".concat(e):"",".json")),className:"rounded border px-4 py-2",children:"Download JSON"}),(0,s.jsx)("button",{onClick:()=>u&&((e,t,a)=>{let s=e=>{let t=(null!=e?e:"").toString();return/[",\n]/.test(t)?'"'+t.replace(/"/g,'""')+'"':t},n=[t.join(",")];for(let a of e)n.push(t.map(e=>s(a[e])).join(","));let l=new Blob([n.join("\n")],{type:"text/csv;charset=utf-8"}),i=URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=a,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(i)})(u,["date","session","name","email","phone","qty","status","user_id","created_at"],"annadanam-bookings".concat(e?"-".concat(e):"",".csv")),className:"rounded border px-4 py-2",children:"Download CSV"}),(0,s.jsx)("button",{onClick:j,className:"rounded border px-4 py-2",children:"Download PDF"})]}),x&&(0,s.jsx)("p",{className:"text-sm text-red-600",role:"alert",children:x}),Array.isArray(u)&&(0,s.jsxs)("div",{className:"overflow-x-auto border rounded-lg",children:[(0,s.jsx)("div",{className:"p-3 text-sm text-muted-foreground",children:(()=>{let e=u.length,t=u.filter(e=>!!e.attended_at).length;return(0,s.jsxs)("span",{children:["Attended: ",(0,s.jsx)("strong",{children:t})," / Total: ",(0,s.jsx)("strong",{children:e})]})})()}),(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-muted/50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Date"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Session"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Name"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Email"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Phone"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Qty"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Attended"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:"Created"})]})}),(0,s.jsx)("tbody",{children:0===u.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-3 py-3",colSpan:9,children:"No records."})}):u.map((e,t)=>{var a;let n=((e,t)=>{if(!e||!t)return!1;let a=(t.split("-")[1]||"").trim().match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i);if(!a)return new Date(e)<new Date(new Date().toISOString().slice(0,10));let[s,n,l,i]=a,r=parseInt(n,10)%12;"PM"===i.toUpperCase()&&(r+=12);let o=new Date(e+"T00:00:00");return!Number.isNaN(o.getTime())&&(o.setHours(r,parseInt(l,10),0,0),new Date>=o)})(e.date,e.session);return(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"px-3 py-2 ".concat(n?"line-through text-muted-foreground":""),children:e.date}),(0,s.jsx)("td",{className:"px-3 py-2 ".concat(n?"line-through text-muted-foreground":""),children:e.session}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.name}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.email}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.phone}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.qty}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.status}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.attended_at?String(e.attended_at).slice(0,19).replace("T"," "):"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:null==(a=e.created_at)?void 0:a.slice(0,19).replace("T"," ")})]},t)})})]})]})]})]})})})}},20063:(e,t,a)=>{"use strict";var s=a(47260);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},33946:(e,t,a)=>{"use strict";a.d(t,{M:()=>r,S:()=>o});var s=a(95155),n=a(12115),l=a(65034);let i=(0,n.createContext)(null);function r(){let e=(0,n.useContext)(i);return e||{show:e=>{var t;let a="".concat(null!=(t=e.title)?t:"").concat(e.description?": ".concat(e.description):"").trim();try{a&&window.alert(a)}catch(e){}}}}function o(e){let{children:t}=e,[a,r]=(0,n.useState)([]),[o,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>c(!0),[]);let d=(0,n.useCallback)(e=>{var t,a,s;let n=Date.now()+Math.floor(1e3*Math.random()),l={id:n,title:null!=(t=e.title)?t:"",description:null!=(a=e.description)?a:"",variant:null!=(s=e.variant)?s:"info",durationMs:"number"==typeof e.durationMs?e.durationMs:3e3};r(e=>[...e,l]),l.durationMs&&l.durationMs>0&&setTimeout(()=>{r(e=>e.filter(e=>e.id!==n))},l.durationMs)},[]),u=(0,n.useMemo)(()=>({show:d}),[d]);return(0,s.jsxs)(i.Provider,{value:u,children:[t,o?(0,s.jsx)("div",{suppressHydrationWarning:!0,className:"pointer-events-none fixed bottom-4 right-4 z-50 flex w-[92vw] max-w-md flex-col-reverse gap-3 sm:w-auto",children:a.map(e=>(0,s.jsx)("div",{className:"pointer-events-auto",children:(0,s.jsx)(l.A,{variant:e.variant,title:e.title,description:e.description})},e.id))}):null]})}},38320:(e,t,a)=>{Promise.resolve().then(a.bind(a,10323))},52828:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(95155),n=a(12115),l=a(20063),i=a(96648);function r(e){let{children:t}=e,[a,r]=(0,n.useState)(!0),o=(0,l.useRouter)();return((0,n.useEffect)(()=>{(async()=>{try{let e=(0,i.getSupabaseBrowserClient)(),{data:t}=await e.auth.getUser(),a=null==t?void 0:t.user,s="ssabarisasthass@gmail.com".split(/[,\s;]+/).filter(Boolean);if(!(a&&(0===s.length||s.includes((a.email||"").toLowerCase()))))return void o.replace("/admin");r(!1)}catch(e){o.replace("/admin")}})()},[o]),a)?(0,s.jsx)("main",{className:"min-h-screen grid place-items-center",children:(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Verifying admin access…"})}):(0,s.jsx)(s.Fragment,{children:t})}},54348:(e,t,a)=>{"use strict";async function s(e,t,s,n,l){let{PDFDocument:i,StandardFonts:r,rgb:o}=await a.e(3394).then(a.bind(a,63394)),c=await i.create(),d=c.addPage(),{width:u,height:m}=d.getSize(),h=await c.embedFont(r.Helvetica),p=await c.embedFont(r.HelveticaBold),x=u-72,f=s.reduce((e,t)=>e+t.w,0),b=s.map(e=>({...e}));if(f>x){let e=x/f;b=s.map(t=>({...t,w:Math.max(40,Math.floor(t.w*e))}))}function g(a,s){let l=t?"".concat(e," — ").concat(t):e;a.drawText(l,{x:36,y:s-20,size:20,font:p,color:o(0,0,0)});let i=s-20-6,r="Exported: ".concat(new Date().toLocaleString(),"  |  Total: ").concat(n.length);a.drawText(r,{x:36,y:i-10,size:10,font:h,color:o(.25,.25,.25)}),i-=20;let c=b.reduce((e,t)=>e+t.w,0),d=i-24;a.drawRectangle({x:36,y:d,width:c,height:24,color:o(.2,.2,.2)});let u=36,m=d+6.5+2;for(let e of b){let t=e.w,s=u+6;"center"===e.align?s=u+(t-p.widthOfTextAtSize(e.label,11))/2:"right"===e.align&&(s=u+t-p.widthOfTextAtSize(e.label,11)-6),a.drawText(e.label,{x:s,y:m,size:11,font:p,color:o(1,1,1)}),a.drawLine({start:{x:u,y:d},end:{x:u,y:d+24},thickness:.3,color:o(0,0,0)}),u+=t}return a.drawLine({start:{x:u,y:d},end:{x:u,y:d+24},thickness:.3,color:o(0,0,0)}),a.drawLine({start:{x:36,y:d},end:{x:u,y:d},thickness:.6,color:o(0,0,0)}),d-8}let y=g(d,m-36);for(let e of n){if(y<56){let e=c.addPage([u,m]);({width:u,height:m}=e.getSize()),y=g(e,m-36),d=e}let t=36;for(let a of b){let s=a.w,n=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,n=(null!=e?e:"").toString();if(a.widthOfTextAtSize(n,s)<=t-8)return n;let l=0,i=n.length;for(;l<i;){let e=Math.floor((l+i+1)/2),r=n.slice(0,e)+"…";a.widthOfTextAtSize(r,s)<=t-8?l=e:i=e-1}return n.slice(0,l)+"…"}(e[a.key],s,h,10),l=t+6;"center"===a.align?l=t+(s-h.widthOfTextAtSize(n,10))/2:"right"===a.align&&(l=t+s-h.widthOfTextAtSize(n,10)-6),d.drawText(n,{x:l,y,size:10,font:h,color:o(0,0,0)}),d.drawLine({start:{x:t,y:y-6},end:{x:t,y:y+14},thickness:.2,color:o(.85,.85,.85)}),t+=s}d.drawLine({start:{x:t,y:y-6},end:{x:t,y:y+14},thickness:.2,color:o(.85,.85,.85)}),d.drawLine({start:{x:36,y:y-6},end:{x:t,y:y-6},thickness:.3,color:o(.75,.75,.75)}),y-=20}let j=new Blob([await c.save()],{type:"application/pdf"}),w=URL.createObjectURL(j),N=document.createElement("a");N.href=w,N.download=l.endsWith(".pdf")?l:"".concat(l,".pdf"),document.body.appendChild(N),N.click(),N.remove(),URL.revokeObjectURL(w)}a.d(t,{Z:()=>s})},64269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(2821),n=a(75889);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,s.$)(t))}},65034:(e,t,a)=>{"use strict";a.d(t,{A:()=>h});var s=a(95155),n=a(12115),l=a(24342),i=a(951),r=a(61362),o=a(65229),c=a(52056),d=a(23327),u=a(64269);let m={success:(0,s.jsx)(r.A,{className:"h-6 w-6"}),error:(0,s.jsx)(o.A,{className:"h-6 w-6"}),warning:(0,s.jsx)(c.A,{className:"h-6 w-6"}),info:(0,s.jsx)(d.A,{className:"h-6 w-6"})};function h(e){let{variant:t="success",title:a="Default Alert Title",description:r="This is a default description for the alert. You can customize this text by passing props."}=e,[c,d]=(0,n.useState)(!0);return(0,s.jsx)(l.N,{children:c&&(0,s.jsxs)(i.P.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.25},className:(0,u.cn)("relative w-full max-w-md mx-auto p-4 rounded-2xl shadow-lg border","bg-white text-black border-black/10"),role:"status","aria-live":"polite",children:[(0,s.jsx)("button",{onClick:()=>d(!1),className:"absolute top-3 right-3 rounded-full p-1 hover:bg-black/10 transition","aria-label":"Dismiss alert",children:(0,s.jsx)(o.A,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 font-normal",children:m[t]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h4",{className:"text-base font-semibold",children:a}),r&&(0,s.jsx)("p",{className:"text-sm text-black opacity-80 mt-1",children:r})]})]})]})})}},96648:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getSupabaseBrowserClient:()=>l});var s=a(85553);let n=globalThis;function l(){let e="https://lszcuaduebvabtifhbgp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzemN1YWR1ZWJ2YWJ0aWZoYmdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzOTk5NTIsImV4cCI6MjA3NDk3NTk1Mn0.voMu1-4SKxSjZ1LK6x7shGKFI37YW8PtLFJKpPYvCAM";if(!e||!t)throw Error("Supabase env vars missing. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");let a=function(e,t){try{let t=new URL(e).host.split(".")[0];return"ayya.supabase.".concat(t,".auth.v1")}catch(e){return"ayya.supabase.".concat((t||"").slice(0,8),".auth.v1")}}(e,t);if(n.__supabaseClients[a])return n.__supabaseClients[a];let l=(0,s.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,flowType:"pkce",detectSessionInUrl:!0,storageKey:a},global:{headers:{"x-ayya-client":"web"}},realtime:{params:{eventsPerSecond:2}}});return n.__supabaseClients[a]=l,l}null!=n.__supabaseClients||(n.__supabaseClients={})}},e=>{e.O(0,[1029,5553,951,4909,2090,8441,1255,7358],()=>e(e.s=38320)),_N_E=e.O()}]);