(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6648,6769],{20063:(e,t,a)=>{"use strict";var s=a(47260);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},33946:(e,t,a)=>{"use strict";a.d(t,{M:()=>n,S:()=>o});var s=a(95155),r=a(12115),i=a(65034);let l=(0,r.createContext)(null);function n(){let e=(0,r.useContext)(l);return e||{show:e=>{var t;let a="".concat(null!=(t=e.title)?t:"").concat(e.description?": ".concat(e.description):"").trim();try{a&&window.alert(a)}catch(e){}}}}function o(e){let{children:t}=e,[a,n]=(0,r.useState)([]),[o,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>u(!0),[]);let c=(0,r.useCallback)(e=>{var t,a,s;let r=Date.now()+Math.floor(1e3*Math.random()),i={id:r,title:null!=(t=e.title)?t:"",description:null!=(a=e.description)?a:"",variant:null!=(s=e.variant)?s:"info",durationMs:"number"==typeof e.durationMs?e.durationMs:3e3};n(e=>[...e,i]),i.durationMs&&i.durationMs>0&&setTimeout(()=>{n(e=>e.filter(e=>e.id!==r))},i.durationMs)},[]),d=(0,r.useMemo)(()=>({show:c}),[c]);return(0,s.jsxs)(l.Provider,{value:d,children:[t,o?(0,s.jsx)("div",{suppressHydrationWarning:!0,className:"pointer-events-none fixed bottom-4 right-4 z-50 flex w-[92vw] max-w-md flex-col-reverse gap-3 sm:w-auto",children:a.map(e=>(0,s.jsx)("div",{className:"pointer-events-auto",children:(0,s.jsx)(i.A,{variant:e.variant,title:e.title,description:e.description})},e.id))}):null]})}},64269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>i});var s=a(2821),r=a(75889);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},65034:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var s=a(95155),r=a(12115),i=a(24342),l=a(951),n=a(61362),o=a(65229),u=a(52056),c=a(23327),d=a(64269);let m={success:(0,s.jsx)(n.A,{className:"h-6 w-6"}),error:(0,s.jsx)(o.A,{className:"h-6 w-6"}),warning:(0,s.jsx)(u.A,{className:"h-6 w-6"}),info:(0,s.jsx)(c.A,{className:"h-6 w-6"})};function p(e){let{variant:t="success",title:a="Default Alert Title",description:n="This is a default description for the alert. You can customize this text by passing props."}=e,[u,c]=(0,r.useState)(!0);return(0,s.jsx)(i.N,{children:u&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.25},className:(0,d.cn)("relative w-full max-w-md mx-auto p-4 rounded-2xl shadow-lg border","bg-white text-black border-black/10"),role:"status","aria-live":"polite",children:[(0,s.jsx)("button",{onClick:()=>c(!1),className:"absolute top-3 right-3 rounded-full p-1 hover:bg-black/10 transition","aria-label":"Dismiss alert",children:(0,s.jsx)(o.A,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 font-normal",children:m[t]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h4",{className:"text-base font-semibold",children:a}),n&&(0,s.jsx)("p",{className:"text-sm text-black opacity-80 mt-1",children:n})]})]})]})})}},87756:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(95155),r=a(12115),i=a(33946),l=a(20063),n=a(96648);function o(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)(),{show:a}=(0,i.M)();return(0,r.useEffect)(()=>{(async()=>{let s=(0,n.getSupabaseBrowserClient)(),r=new URL(window.location.href),i=r.searchParams.get("code"),l=i?"ayya.oauth.exchange:".concat(i):null;if(l)try{if(sessionStorage.getItem(l)){let a=(0,n.getSupabaseBrowserClient)(),{data:s}=await a.auth.getSession();if(null==s?void 0:s.session){let a=t.get("next")||"/";e.replace(a);return}}else sessionStorage.setItem(l,"1")}catch(e){}let o=r.searchParams.get("error_description")||r.searchParams.get("error");if(o){let t=String(o);if(/flow state not found/i.test(t))try{let e="ayya.oauth.retry";if("1"===sessionStorage.getItem(e))sessionStorage.removeItem(e);else{sessionStorage.setItem(e,"1");let t="https://app.sabarisastha.org".replace(/\/$/,"");await s.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(t,"/auth/callback"),queryParams:{prompt:"select_account"}}});return}}catch(e){}console.error("IdP error:",o),a({title:"Sign-in failed",description:t,variant:"error",durationMs:4500}),e.replace("/sign-in/");return}let{data:u}=await s.auth.getSession(),c=async e=>{let{data:a}=await s.auth.getUser(),r=null==a?void 0:a.user;if(!r)return"/sign-in/";let{data:i}=await s.from("Profile-Table").select("*").eq("user_id",r.id).maybeSingle();if(!i){var l;i=null!=(l=(await s.from("Profile-Table").select("*").eq("id",r.id).maybeSingle()).data)?l:null}return i?t.get("next")||e:"/profile/edit"};if(!i){if(null==u?void 0:u.session){let t=await c("/");e.replace(t);return}e.replace("/sign-in/");return}if(null==u?void 0:u.session){let t=await c("/");e.replace(t);return}let d=async()=>{var r,i,l,n,o,u,c,d,m,p;let{data:f}=await s.auth.getUser(),h=null==f?void 0:f.user,g=t.get("next")||"/";try{let e=sessionStorage.getItem("ayya.auth.next");e&&(g=e,sessionStorage.removeItem("ayya.auth.next"))}catch(e){}if(!h)return void e.replace("/sign-in/");let v=!1;try{let e=null!=(n=h.email)?n:"",t=((null==(r=h.user_metadata)?void 0:r.full_name)||(null==(i=h.user_metadata)?void 0:i.name)||"").toString(),a=((null==(l=h.user_metadata)?void 0:l.avatar_url)||"").toString(),c=[{user_id:h.id,email:e,name:t,full_name:t,avatar_url:a},{id:h.id,email:e,name:t,full_name:t,avatar_url:a}],d=!1;for(let e of c)if(!(await s.from("Profile-Table").upsert(e,{onConflict:Object.keys(e)[0]}).select("*")).error){d=!0;break}d||console.warn("Upsert into Profile-Table failed; check schema/policies.");let{data:m}=await s.from("Profile-Table").select("*").eq("user_id",h.id).maybeSingle();m||(m=null!=(o=(await s.from("Profile-Table").select("*").eq("id",h.id).maybeSingle()).data)?o:null);try{let e=(null==m?void 0:m.avatar_url)||(null==m?void 0:m.image_url)||"",t=a&&/googleusercontent\.com/i.test(a),r=e&&/supabase\.co\//i.test(e);if(t&&!r){let e=await fetch(a);if(e.ok){let t=await e.blob(),a=((null==(u=t.type)?void 0:u.split("/")[1])||"jpg").replace(/[^a-z0-9]/gi,""),r="avatars/".concat(h.id,"-oauth-").concat(Date.now(),".").concat(a);if(!(await s.storage.from("avatars").upload(r,t,{upsert:!1,contentType:t.type||"image/jpeg",cacheControl:"3600"})).error){let{data:e}=s.storage.from("avatars").getPublicUrl(r);if(null==e?void 0:e.publicUrl){let t=(null==m?void 0:m.user_id)?"user_id":"id";await s.from("Profile-Table").update({avatar_url:e.publicUrl,image_url:e.publicUrl}).eq(t,h.id);try{await s.from("profile_photos").insert({user_id:h.id,url:e.publicUrl})}catch(e){}}}}}}catch(e){console.warn("Avatar upload skipped:",(null==e?void 0:e.message)||e)}v=!m}catch(e){console.warn("Profile upsert skipped:",e)}try{let e=((null==(c=row)?void 0:c.name)||(null==(d=row)?void 0:d.full_name)||(null==(m=h.user_metadata)?void 0:m.full_name)||(null==(p=h.user_metadata)?void 0:p.name)||h.email||"").toString();a({title:"Welcome",description:"".concat(e),variant:"success"})}catch(e){}e.replace(v?"/profile/edit":g)},{data:m}=await s.auth.getSession();if(!(null==m?void 0:m.session)){let{data:t}=s.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)&&d()});setTimeout(()=>{try{t.subscription.unsubscribe()}catch(e){}e.replace("/sign-in/")},3e4);return}await d()})()},[e,t]),(0,s.jsx)("main",{className:"min-h-[60vh] flex items-center justify-center text-sm text-muted-foreground",children:"Completing sign-in…"})}function u(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("main",{className:"min-h-[60vh] flex items-center justify-center text-sm text-muted-foreground",children:"Loading…"}),children:(0,s.jsx)(o,{})})}},90401:(e,t,a)=>{Promise.resolve().then(a.bind(a,87756))},96648:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getSupabaseBrowserClient:()=>i});var s=a(85553);let r=globalThis;function i(){let e="https://lszcuaduebvabtifhbgp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzemN1YWR1ZWJ2YWJ0aWZoYmdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzOTk5NTIsImV4cCI6MjA3NDk3NTk1Mn0.voMu1-4SKxSjZ1LK6x7shGKFI37YW8PtLFJKpPYvCAM";if(!e||!t)throw Error("Supabase env vars missing. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");let a=function(e,t){try{let t=new URL(e).host.split(".")[0];return"ayya.supabase.".concat(t,".auth.v1")}catch(e){return"ayya.supabase.".concat((t||"").slice(0,8),".auth.v1")}}(e,t);if(r.__supabaseClients[a])return r.__supabaseClients[a];let i=(0,s.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,flowType:"pkce",detectSessionInUrl:!0,storageKey:a},global:{headers:{"x-ayya-client":"web"}},realtime:{params:{eventsPerSecond:2}}});return r.__supabaseClients[a]=i,i}null!=r.__supabaseClients||(r.__supabaseClients={})}},e=>{e.O(0,[1029,5553,951,4909,2090,8441,1255,7358],()=>e(e.s=90401)),_N_E=e.O()}]);