(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6648,9437],{20063:(e,t,a)=>{"use strict";var s=a(47260);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},33946:(e,t,a)=>{"use strict";a.d(t,{M:()=>i,S:()=>o});var s=a(95155),n=a(12115),r=a(65034);let l=(0,n.createContext)(null);function i(){let e=(0,n.useContext)(l);return e||{show:e=>{var t;let a="".concat(null!=(t=e.title)?t:"").concat(e.description?": ".concat(e.description):"").trim();try{a&&window.alert(a)}catch(e){}}}}function o(e){let{children:t}=e,[a,i]=(0,n.useState)([]),[o,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>c(!0),[]);let d=(0,n.useCallback)(e=>{var t,a,s;let n=Date.now()+Math.floor(1e3*Math.random()),r={id:n,title:null!=(t=e.title)?t:"",description:null!=(a=e.description)?a:"",variant:null!=(s=e.variant)?s:"info",durationMs:"number"==typeof e.durationMs?e.durationMs:3e3};i(e=>[...e,r]),r.durationMs&&r.durationMs>0&&setTimeout(()=>{i(e=>e.filter(e=>e.id!==n))},r.durationMs)},[]),u=(0,n.useMemo)(()=>({show:d}),[d]);return(0,s.jsxs)(l.Provider,{value:u,children:[t,o?(0,s.jsx)("div",{suppressHydrationWarning:!0,className:"pointer-events-none fixed bottom-4 right-4 z-50 flex w-[92vw] max-w-md flex-col-reverse gap-3 sm:w-auto",children:a.map(e=>(0,s.jsx)("div",{className:"pointer-events-auto",children:(0,s.jsx)(r.A,{variant:e.variant,title:e.title,description:e.description})},e.id))}):null]})}},44558:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(95155),n=a(12115),r=a(33946),l=a(96648),i=a(20063),o=a(52828);function c(){let[e,t]=(0,n.useState)(""),[a,c]=(0,n.useState)(""),{show:d}=(0,r.M)(),u=(0,i.useRouter)();async function m(e,t){let a=(0,l.getSupabaseBrowserClient)(),s=e=>e?new Date(e+"T00:00:00").toISOString():null,[n,r,i,o,c]=await Promise.all([a.rpc("admin_list_pooja_bookings",{start_date:e||null,end_date:t||null,sess:null,limit_rows:5e3,offset_rows:0}),a.rpc("admin_list_annadanam_bookings",{start_date:e||null,end_date:t||null,sess:null,limit_rows:5e3,offset_rows:0}),a.rpc("admin_list_donations",{start_ts:s(e),end_ts:s(t),limit_rows:5e3,offset_rows:0}),a.rpc("admin_list_contact_us",{start_ts:s(e),end_ts:s(t),limit_rows:5e3,offset_rows:0}),a.rpc("admin_list_volunteer_bookings",{start_date:e||null,end_date:t||null,sess:null,limit_rows:5e3,offset_rows:0})]),d=e=>(null==e?void 0:e.error)?[]:Array.isArray(null==e?void 0:e.data)?e.data:[],u=[];try{let e=await a.from("Profile-Table").select("*").limit(5e3);e.error||(u=Array.isArray(e.data)?e.data:[])}catch(e){}return{users:[],profiles:u,pooja_bookings:d(n),annadanam_bookings:d(r),donations:d(i),contact_messages:d(o),volunteer_bookings:d(c)}}let p=async t=>{try{var s;let n=(0,l.getSupabaseBrowserClient)(),{data:r}=await n.auth.getSession();if(!(null==r||null==(s=r.session)?void 0:s.access_token))throw Error("Not authenticated");let i=await m(e,a);if("json"===t){let e=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="admin-export-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(t)}else if("csv"===t){let t=[{name:"Users",data:i.users},{name:"Profiles",data:i.profiles},{name:"Pooja Bookings",data:i.pooja_bookings},{name:"Annadanam Bookings",data:i.annadanam_bookings},{name:"Donations",data:i.donations},{name:"Contact Messages",data:i.contact_messages},{name:"Volunteer Bookings",data:i.volunteer_bookings}],s="Admin Data Export - ".concat(new Date().toISOString(),"\n");for(let n of(s+="Date Range: ".concat(e||"all"," to ").concat(a||"all","\n\n"),t))if(s+="\n".concat(n.name,"\n"),Array.isArray(n.data)&&n.data.length>0){let e=Object.keys(n.data[0]);for(let t of(s+=e.join(",")+"\n",n.data)){let a=e.map(e=>{var a;let s=null!=(a=t[e])?a:"",n="object"==typeof s?JSON.stringify(s):String(s);return/[",\n]/.test(n)?'"'+n.replace(/"/g,'""')+'"':n});s+=a.join(",")+"\n"}}else s+="No data\n";let n=new Blob([s],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(n),l=document.createElement("a");l.href=r,l.download="admin-export-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(r)}d({title:"Export Complete",description:"Downloaded ".concat(t.toUpperCase()," file successfully."),variant:"success"})}catch(e){d({title:"Export Failed",description:(null==e?void 0:e.message)||"Failed to export data",variant:"destructive"})}};return(0,s.jsx)(o.A,{children:(0,s.jsx)("main",{className:"min-h-screen p-6 md:p-10",children:(0,s.jsxs)("div",{className:"mx-auto max-w-3xl",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center",children:"Export Data"}),(0,s.jsx)("div",{className:"mt-2 flex justify-between",children:(0,s.jsx)("button",{onClick:()=>u.push("/admin"),className:"rounded border px-3 py-1.5",children:"Back"})}),(0,s.jsxs)("div",{className:"rounded-xl border p-6 space-y-4 bg-card/70 mt-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",htmlFor:"start",children:"Start date"}),(0,s.jsx)("input",{id:"start",type:"date",className:"w-full rounded border px-3 py-2 bg-background",value:e,onChange:e=>t(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm",htmlFor:"end",children:"End date"}),(0,s.jsx)("input",{id:"end",type:"date",className:"w-full rounded border px-3 py-2 bg-background",value:a,onChange:e=>c(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,s.jsx)("button",{onClick:()=>p("json"),className:"rounded bg-black text-white px-4 py-2",children:"Download JSON"}),(0,s.jsx)("button",{onClick:()=>p("csv"),className:"rounded border px-4 py-2",children:"Download CSV"})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Exports all data (Annadanam, Pooja, Donations, Contact, Volunteers) within the date range."})]})]})})})}},47317:(e,t,a)=>{Promise.resolve().then(a.bind(a,44558))},52828:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(95155),n=a(12115),r=a(20063),l=a(96648);function i(e){let{children:t}=e,[a,i]=(0,n.useState)(!0),o=(0,r.useRouter)();return((0,n.useEffect)(()=>{(async()=>{try{let e=(0,l.getSupabaseBrowserClient)(),{data:t}=await e.auth.getUser(),a=null==t?void 0:t.user,s="ssabarisasthass@gmail.com".split(/[,\s;]+/).filter(Boolean);if(!(a&&(0===s.length||s.includes((a.email||"").toLowerCase()))))return void o.replace("/admin");i(!1)}catch(e){o.replace("/admin")}})()},[o]),a)?(0,s.jsx)("main",{className:"min-h-screen grid place-items-center",children:(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Verifying admin accessâ€¦"})}):(0,s.jsx)(s.Fragment,{children:t})}},64269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var s=a(2821),n=a(75889);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,s.$)(t))}},65034:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var s=a(95155),n=a(12115),r=a(24342),l=a(951),i=a(61362),o=a(65229),c=a(52056),d=a(23327),u=a(64269);let m={success:(0,s.jsx)(i.A,{className:"h-6 w-6"}),error:(0,s.jsx)(o.A,{className:"h-6 w-6"}),warning:(0,s.jsx)(c.A,{className:"h-6 w-6"}),info:(0,s.jsx)(d.A,{className:"h-6 w-6"})};function p(e){let{variant:t="success",title:a="Default Alert Title",description:i="This is a default description for the alert. You can customize this text by passing props."}=e,[c,d]=(0,n.useState)(!0);return(0,s.jsx)(r.N,{children:c&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.25},className:(0,u.cn)("relative w-full max-w-md mx-auto p-4 rounded-2xl shadow-lg border","bg-white text-black border-black/10"),role:"status","aria-live":"polite",children:[(0,s.jsx)("button",{onClick:()=>d(!1),className:"absolute top-3 right-3 rounded-full p-1 hover:bg-black/10 transition","aria-label":"Dismiss alert",children:(0,s.jsx)(o.A,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 font-normal",children:m[t]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h4",{className:"text-base font-semibold",children:a}),i&&(0,s.jsx)("p",{className:"text-sm text-black opacity-80 mt-1",children:i})]})]})]})})}},96648:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getSupabaseBrowserClient:()=>r});var s=a(85553);let n=globalThis;function r(){let e="https://lszcuaduebvabtifhbgp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzemN1YWR1ZWJ2YWJ0aWZoYmdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzOTk5NTIsImV4cCI6MjA3NDk3NTk1Mn0.voMu1-4SKxSjZ1LK6x7shGKFI37YW8PtLFJKpPYvCAM";if(!e||!t)throw Error("Supabase env vars missing. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");let a=function(e,t){try{let t=new URL(e).host.split(".")[0];return"ayya.supabase.".concat(t,".auth.v1")}catch(e){return"ayya.supabase.".concat((t||"").slice(0,8),".auth.v1")}}(e,t);if(n.__supabaseClients[a])return n.__supabaseClients[a];let r=(0,s.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,flowType:"pkce",detectSessionInUrl:!0,storageKey:a},global:{headers:{"x-ayya-client":"web"}},realtime:{params:{eventsPerSecond:2}}});return n.__supabaseClients[a]=r,r}null!=n.__supabaseClients||(n.__supabaseClients={})}},e=>{e.O(0,[1029,5553,951,4909,2090,8441,1255,7358],()=>e(e.s=47317)),_N_E=e.O()}]);