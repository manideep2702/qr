(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6648,9413],{7902:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(95155),n=s(12115),r=s(20063),l=s(96648);function i(){let[e,t]=(0,n.useState)(""),[s,i]=(0,n.useState)(!1),[o,u]=(0,n.useState)(!1),[d,c]=(0,n.useState)(""),[m,p]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!1),[h,b]=(0,n.useState)(0),[g,y]=(0,n.useState)(null),[v,w]=(0,n.useState)(""),[N,S]=(0,n.useState)(""),[j,k]=(0,n.useState)(!1),[C,I]=(0,n.useState)(null),[_,P]=(0,n.useState)(null),U=(0,r.useRouter)();function E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;b(e);try{g&&clearInterval(g)}catch(e){}let t=setInterval(()=>{b(e=>{if(e<=1){try{clearInterval(t)}catch(e){}return y(null),0}return e-1})},1e3);y(t)}async function R(t){t&&t.preventDefault(),P(null),I(null);let s=e.trim();if(!/.+@.+\..+/.test(s))return void P("Enter a valid email");if(!(h>0)){try{let e=await fetch("/api/auth/check-email?email=".concat(encodeURIComponent(s)));if(e.ok){let t=await e.json();if((null==t?void 0:t.exists)!==!0)return void P("No account found with this email.")}}catch(e){}i(!0);try{let e=(0,l.getSupabaseBrowserClient)(),{error:t}=await e.auth.signInWithOtp({email:s,options:{shouldCreateUser:!1}});if(t){let e=t.message||"Failed to send code";P(e),/rate\s*limit/i.test(e)&&E(60);return}u(!0),I("Verification code sent to your email."),E(60)}catch(e){P((null==e?void 0:e.message)||"Unexpected error")}finally{i(!1)}}}async function B(){P(null),I(null);let t=e.trim(),s=d.trim();if(!s)return void P("Enter the code you received");p(!0);try{let e=(0,l.getSupabaseBrowserClient)(),{data:a,error:n}=await e.auth.verifyOtp({email:t,token:s,type:"email"});if(n)return void P(n.message||"Invalid code");if(!(null==a?void 0:a.session))return void P("Verification succeeded but no session was created. Please resend the code.");f(!0),I("Verified. You can now set a new password.")}catch(e){P((null==e?void 0:e.message)||"Unexpected error")}finally{p(!1)}}async function J(e){if(e.preventDefault(),P(null),I(null),!x)return void P("Please verify the code first");if(!v||v!==N)return void P("Passwords do not match");k(!0);try{let e=(0,l.getSupabaseBrowserClient)(),{data:t}=await e.auth.getSession();if(!(null==t?void 0:t.session))return void P("Session expired. Please verify again.");let{error:s}=await e.auth.updateUser({password:v});if(s)return void P(s.message||"Failed to update password");I("Password updated. You can now sign in."),setTimeout(()=>U.replace("/sign-in/"),1200)}catch(e){P((null==e?void 0:e.message)||"Unexpected error")}finally{k(!1)}}return(0,n.useEffect)(()=>{if(f(!1),u(!1),c(""),I(null),P(null),b(0),g){try{clearInterval(g)}catch(e){}y(null)}},[e]),(0,a.jsx)("main",{className:"min-h-screen flex items-center justify-center bg-background text-foreground",children:(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-2xl border border-border bg-card/70 p-6 shadow-sm",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Reset password with code"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"We’ll send a 6‑digit code to your email."}),(0,a.jsxs)("form",{onSubmit:R,className:"mt-4 grid gap-3",children:[(0,a.jsxs)("label",{className:"block text-left",children:[(0,a.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Email"}),(0,a.jsx)("input",{type:"email",value:e,onChange:e=>t(e.target.value),className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border focus:ring-2 focus:outline-none",placeholder:"you@example.com",required:!0})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",disabled:s||h>0,className:"rounded-xl bg-primary text-primary-foreground px-4 py-2 text-sm disabled:opacity-50",children:s?"Sending…":o?h>0?"Resend ".concat(h,"s"):"Resend code":"Send code"}),(0,a.jsx)("button",{type:"button",onClick:()=>U.back(),className:"text-xs underline text-muted-foreground self-center",children:"Back"})]})]}),o&&!x&&(0,a.jsxs)("div",{className:"mt-4 grid gap-2",children:[(0,a.jsxs)("label",{className:"block text-left",children:[(0,a.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Enter code"}),(0,a.jsx)("input",{value:d,onChange:e=>c(e.target.value),inputMode:"numeric",className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border focus:ring-2 focus:outline-none",placeholder:"123456"})]}),(0,a.jsx)("button",{type:"button",onClick:B,disabled:m||!d,className:"rounded-xl bg-primary text-primary-foreground px-4 py-2 text-sm disabled:opacity-50",children:m?"Verifying…":"Verify code"})]}),x&&(0,a.jsxs)("form",{onSubmit:J,className:"mt-4 grid gap-3",children:[(0,a.jsxs)("label",{className:"block text-left",children:[(0,a.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"New password"}),(0,a.jsx)("input",{type:"password",value:v,onChange:e=>w(e.target.value),className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border focus:ring-2 focus:outline-none",required:!0})]}),(0,a.jsxs)("label",{className:"block text-left",children:[(0,a.jsx)("span",{className:"mb-1 block text-xs font-medium text-foreground",children:"Confirm password"}),(0,a.jsx)("input",{type:"password",value:N,onChange:e=>S(e.target.value),className:"w-full rounded-xl bg-white/5 px-4 py-3 text-sm ring-1 ring-border focus:ring-2 focus:outline-none",required:!0})]}),(0,a.jsx)("button",{disabled:j,className:"rounded-xl bg-primary text-primary-foreground px-4 py-2 text-sm disabled:opacity-50",children:j?"Updating…":"Update password"})]}),_?(0,a.jsx)("p",{className:"mt-3 text-xs text-red-500",children:_}):null,C?(0,a.jsx)("p",{className:"mt-3 text-xs text-emerald-500",children:C}):null]})})}},20063:(e,t,s)=>{"use strict";var a=s(47260);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},48421:(e,t,s)=>{Promise.resolve().then(s.bind(s,7902))},96648:(e,t,s)=>{"use strict";s.r(t),s.d(t,{getSupabaseBrowserClient:()=>r});var a=s(85553);let n=globalThis;function r(){let e="https://lszcuaduebvabtifhbgp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzemN1YWR1ZWJ2YWJ0aWZoYmdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzOTk5NTIsImV4cCI6MjA3NDk3NTk1Mn0.voMu1-4SKxSjZ1LK6x7shGKFI37YW8PtLFJKpPYvCAM";if(!e||!t)throw Error("Supabase env vars missing. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");let s=function(e,t){try{let t=new URL(e).host.split(".")[0];return"ayya.supabase.".concat(t,".auth.v1")}catch(e){return"ayya.supabase.".concat((t||"").slice(0,8),".auth.v1")}}(e,t);if(n.__supabaseClients[s])return n.__supabaseClients[s];let r=(0,a.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,flowType:"pkce",detectSessionInUrl:!0,storageKey:s},global:{headers:{"x-ayya-client":"web"}},realtime:{params:{eventsPerSecond:2}}});return n.__supabaseClients[s]=r,r}null!=n.__supabaseClients||(n.__supabaseClients={})}},e=>{e.O(0,[1029,5553,8441,1255,7358],()=>e(e.s=48421)),_N_E=e.O()}]);